<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.C consulting tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Marked library for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f8fafc; color: #334155; }
        .chart-container { position: relative; width: 100%; max-width: 900px; margin: 0 auto; height: 350px; max-height: 400px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); transition: transform 0.2s; border: 1px solid #e2e8f0; }
        
        /* Main Theme Color: #96c6c7 (Teal/Mint) */
        .bg-theme { background-color: #96c6c7; }
        .bg-theme-hover:hover { background-color: #7ab0b1; }
        .text-theme { color: #5f9ea0; } 
        .border-theme { border-color: #96c6c7; }
        
        .nav-btn.active { background-color: #96c6c7; color: white; font-weight: bold; }
        .nav-btn:not(.active):hover { background-color: #e0f2f2; color: #5f9ea0; }
        
        /* Markdown Styles within AI response */
        .prose h3 { font-size: 1.1em; font-weight: bold; margin-top: 1.2em; margin-bottom: 0.5em; color: #5f9ea0; border-bottom: 2px solid #e0f2f2; padding-bottom: 4px; }
        .prose strong { color: #5f9ea0; font-weight: 600; background: linear-gradient(transparent 60%, #e0f2f2 60%); }
        .prose blockquote { border-left: 4px solid #96c6c7; padding-left: 1em; background-color: #f0f9f9; padding: 0.5em 1em; border-radius: 0 4px 4px 0; font-style: italic; color: #475569; }

        /* Loading Animation */
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #96c6c7;
            border-radius: 50%;
            animation: typing 1s infinite;
            margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-5px); opacity: 1; }
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">

    <!-- Header & Navigation -->
    <nav class="bg-white shadow sticky top-0 z-50 border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-4">
                    <span class="text-lg font-bold text-slate-800 tracking-tight">
                        ğŸ“Š B.C consulting <span class="text-theme">tools</span>
                    </span>
                    <!-- Category Switcher -->
                    <div class="hidden md:flex bg-slate-100 rounded-lg p-1 ml-6">
                        <button onclick="switchCategory('bust')" id="cat-bust" class="px-4 py-1 text-sm rounded-md transition-all shadow-sm bg-white text-theme font-bold">ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢</button>
                        <button onclick="switchCategory('nail')" id="cat-nail" class="px-4 py-1 text-sm rounded-md transition-all text-slate-500 hover:text-slate-700">ãƒã‚¤ãƒ«äº‹æ¥­</button>
                    </div>
                </div>
                <div class="flex space-x-2 items-center overflow-x-auto">
                    <button onclick="switchView('dashboard')" id="nav-dashboard" class="nav-btn active px-3 py-2 rounded-lg text-sm transition whitespace-nowrap">å…¨ä½“åˆ†æ</button>
                    <button onclick="switchView('details')" id="nav-details" class="nav-btn px-3 py-2 rounded-lg text-sm transition whitespace-nowrap">åº—èˆ—è©³ç´°</button>
                    <button onclick="switchView('marketing')" id="nav-marketing" class="nav-btn px-3 py-2 rounded-lg text-sm transition whitespace-nowrap bg-gradient-to-r from-[#96c6c7] to-[#5f9ea0] text-white hover:opacity-90 shadow-md flex items-center"><span class="mr-1">âœ¨</span>AIé›†å®¢ã‚³ãƒ”ãƒ¼</button>
                    <button onclick="switchView('strategy')" id="nav-strategy" class="nav-btn px-3 py-2 rounded-lg text-sm transition whitespace-nowrap">ã‚³ãƒ³ã‚µãƒ«AI</button>
                </div>
            </div>
            <!-- Mobile Category Switcher -->
            <div class="md:hidden pb-3 pt-1 flex justify-center">
                <div class="bg-slate-100 rounded-lg p-1 flex">
                    <button onclick="switchCategory('bust')" id="cat-bust-m" class="px-4 py-1 text-xs rounded-md transition-all shadow-sm bg-white text-theme font-bold">ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢</button>
                    <button onclick="switchCategory('nail')" id="cat-nail-m" class="px-4 py-1 text-xs rounded-md transition-all text-slate-500">ãƒã‚¤ãƒ«</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-6">

        <!-- VIEW 1: DASHBOARD OVERVIEW -->
        <section id="view-dashboard" class="space-y-6 animate-fade-in">
            <div class="flex justify-between items-end border-b pb-4 border-slate-200">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">å…¨ä½“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¨ç§»</h1>
                    <p class="text-sm text-slate-500 mt-1">é¸æŠä¸­ã®äº‹æ¥­éƒ¨: <span id="current-cat-label" class="font-bold text-theme">ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢</span> (2025å¹´4æœˆã€œ2026å¹´1æœˆ)</p>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="card p-5 border-l-4 border-[#96c6c7]">
                    <p class="text-xs font-bold text-slate-400 uppercase">æœŸé–“åˆè¨ˆ PVæ•°</p>
                    <p class="text-2xl font-bold text-slate-800 metric-value mt-1" id="kpi-total-pv">-</p>
                </div>
                <div class="card p-5 border-l-4 border-[#7ab0b1]">
                    <p class="text-xs font-bold text-slate-400 uppercase">æœŸé–“åˆè¨ˆ æ–°è¦æ•°</p>
                    <p class="text-2xl font-bold text-slate-800 metric-value mt-1" id="kpi-total-new">-</p>
                </div>
                <div class="card p-5 border-l-4 border-emerald-500">
                    <p class="text-xs font-bold text-slate-400 uppercase">å¹³å‡CVR (æ–°è¦/PV)</p>
                    <p class="text-2xl font-bold text-slate-800 metric-value mt-1" id="kpi-avg-cvr">-</p>
                </div>
                <div class="card p-5 border-l-4 border-purple-400">
                    <p class="text-xs font-bold text-slate-400 uppercase">åˆ†æå¯¾è±¡åº—èˆ—æ•°</p>
                    <p class="text-2xl font-bold text-slate-800 metric-value mt-1" id="kpi-active-salons">-</p>
                </div>
            </div>

            <!-- Main Trend Chart -->
            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-800">æœˆåˆ¥æ¨ç§»ï¼šPVæ•° vs æ–°è¦ç²å¾—æ•°</h2>
                </div>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
             <!-- Comparison Table -->
             <div class="card p-6">
                <h2 class="text-lg font-bold text-slate-800 mb-4">æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿è©³ç´°</h2>
                <div class="overflow-x-auto custom-scrollbar h-[300px]">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-50 sticky top-0 z-10">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-bold text-slate-500">å¹´æœˆ</th>
                                <th class="px-3 py-2 text-right text-xs font-bold text-slate-500">åˆè¨ˆPV</th>
                                <th class="px-3 py-2 text-right text-xs font-bold text-slate-500">åˆè¨ˆæ–°è¦æ•°</th>
                                <th class="px-3 py-2 text-right text-xs font-bold text-slate-500">å¹³å‡CVR</th>
                            </tr>
                        </thead>
                        <tbody id="monthly-table-body" class="bg-white divide-y divide-slate-100 text-sm">
                            <!-- JS Populated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- VIEW 2: MARKETING AI -->
        <section id="view-marketing" class="space-y-6 hidden">
            <div class="flex justify-between items-end border-b pb-4 border-slate-200">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">HPBé›†å®¢ã‚³ãƒ”ãƒ¼è‡ªå‹•ç”Ÿæˆ</h1>
                    <p class="text-sm text-slate-500 mt-1">ã€Œç¾äººãƒã‚¹ãƒˆã€ç‹¬è‡ªã®å¼·ã¿ï¼ˆåŒ»ç™‚ææºã€98%æˆåŠŸå®Ÿç¸¾ï¼‰ã‚’å­¦ç¿’æ¸ˆã¿ã®AIãŒã€ãƒˆãƒ¬ãƒ³ãƒ‰ã«åˆã‚ã›ãŸæ–‡ç« ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Input Panel -->
                <div class="col-span-1 space-y-4">
                    <div class="card p-5">
                        <h2 class="font-bold text-slate-800 mb-4 flex items-center"><span class="text-xl mr-2">âš™ï¸</span> ç”Ÿæˆè¨­å®š</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">1. ä½œæˆã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</label>
                                <select id="mkt-type" class="w-full border border-slate-300 rounded p-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] text-sm">
                                    <option value="catch_copy">ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼æ¡ˆ (ä¸€è¦§)</option>
                                    <option value="body_copy">ãƒ•ã‚©ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼/ãƒ–ãƒ­ã‚°æœ¬æ–‡</option>
                                    <option value="campaign">æ–°ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒ»ã‚¯ãƒ¼ãƒãƒ³ä¼ç”»</option>
                                    <option value="line_message">LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé…ä¿¡æ–‡</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">2. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤</label>
                                <select id="mkt-target" class="w-full border border-slate-300 rounded p-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] text-sm">
                                    <option value="general">å…¨èˆ¬ (ãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ãŸã„æ–¹)</option>
                                    <option value="skinny">ç—©ã›å‹ã§å¤§ãããªã‚‰ãªã„æ–¹</option>
                                    <option value="postpartum">ç”£å¾Œã®ä¸‹å‚ãƒ»å½¢å´©ã‚Œã«æ‚©ã‚€æ–¹</option>
                                    <option value="bridal">çµå©šå¼ã‚’æ§ãˆãŸãƒ—ãƒ¬èŠ±å«</option>
                                    <option value="failed">ä»–åº—ã§åŠ¹æœãŒå‡ºãªã‹ã£ãŸæ–¹</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">3. å­£ç¯€ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰è¦ç´ </label>
                                <input type="text" id="mkt-trend" class="w-full border border-slate-300 rounded p-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] text-sm" placeholder="ä¾‹: æ­£æœˆå¤ªã‚Šè§£æ¶ˆã€æ˜¥ã®å‡ºä¼šã„ã€è–„ç€ã®å­£ç¯€">
                            </div>

                            <button onclick="generateMarketingContent()" class="w-full bg-gradient-to-r from-[#96c6c7] to-[#5f9ea0] hover:opacity-90 text-white py-3 rounded-lg font-bold shadow-lg transform transition active:scale-95 flex justify-center items-center">
                                <span class="mr-2">âœ¨</span> AIã§ç”Ÿæˆã™ã‚‹
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-cyan-50 p-4 rounded-lg border border-cyan-100 text-xs text-cyan-800">
                        <strong>ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ:</strong><br>
                        ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ”ãƒ¼ã¯Hot Pepper Beautyã®æ–‡å­—æ•°åˆ¶é™ï¼ˆã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ç­‰ï¼‰ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
                    </div>
                </div>

                <!-- Output Panel -->
                <div class="col-span-2">
                    <div id="mkt-output-card" class="card h-full min-h-[500px] flex flex-col relative">
                        <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-lg">
                            <h3 class="font-bold text-slate-700">ç”Ÿæˆçµæœ</h3>
                            <button onclick="copyToClipboard('mkt-result-content')" class="text-xs bg-white border border-slate-300 px-3 py-1 rounded hover:bg-slate-50 text-slate-600">ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>
                        </div>
                        <div id="mkt-result-area" class="p-6 flex-grow overflow-y-auto custom-scrollbar">
                            <div class="h-full flex flex-col justify-center items-center text-slate-400">
                                <span class="text-4xl mb-4">ğŸª„</span>
                                <p>å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¨­å®šã—ã¦<br>ã€Œç”Ÿæˆã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW 3: SALON DETAILS -->
        <section id="view-details" class="space-y-6 hidden">
             <div class="flex justify-between items-end border-b pb-4 border-slate-200">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">åº—èˆ—åˆ¥ è©³ç´°åˆ†æ</h1>
                    <p class="text-sm text-slate-500 mt-1">å€‹åˆ¥ã®åº—èˆ—ã®æœˆæ¬¡æ¨ç§»ã‚’ç¢ºèªã—ã€ç•°å¸¸å€¤ã®åŸå› ã‚’ç‰¹å®šã—ã¾ã™ã€‚</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Sidebar Selector -->
                <div class="col-span-1 card p-4 h-fit bg-white">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <select id="salon-selector" class="block w-full text-base border-slate-300 focus:outline-none focus:ring-[#96c6c7] focus:border-[#96c6c7] rounded-md py-2" size="15">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <!-- Detail Content -->
                <div class="col-span-3 space-y-6">
                    <div class="card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 id="detail-title" class="text-2xl font-bold text-slate-800">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                                <span id="detail-type" class="px-3 py-1 rounded-full text-xs font-bold bg-slate-100 text-slate-600 mt-2 inline-block">-</span>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-slate-500">å¹³å‡æœˆé–“PV</div>
                                <div id="detail-avg-pv" class="text-2xl font-bold text-slate-800 font-mono">-</div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="detailChart"></canvas>
                        </div>
                    </div>
                    <!-- Table -->
                    <div class="card p-6">
                         <h3 class="font-bold text-slate-800 mb-3">æ¨ç§»ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h3>
                         <div class="overflow-x-auto">
                             <table class="min-w-full text-sm text-left">
                                 <thead>
                                     <tr class="border-b border-slate-200 bg-slate-50">
                                         <th class="py-3 px-4 font-bold text-slate-600">å¹´æœˆ</th>
                                         <th class="py-3 px-4 font-bold text-slate-600">ãƒ—ãƒ©ãƒ³</th>
                                         <th class="py-3 px-4 text-right font-bold text-slate-600">PVæ•°</th>
                                         <th class="py-3 px-4 text-right font-bold text-slate-600">æ–°è¦æ•°</th>
                                         <th class="py-3 px-4 text-right font-bold text-slate-600">PVå‰æœˆæ¯”</th>
                                     </tr>
                                 </thead>
                                 <tbody id="detail-table-body" class="divide-y divide-slate-100"></tbody>
                             </table>
                         </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW 4: STRATEGY & CHAT -->
        <section id="view-strategy" class="space-y-6 hidden">
            <div class="flex justify-between items-end border-b pb-4 border-slate-200">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">AIã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆãƒ»ãƒãƒ£ãƒƒãƒˆ</h1>
                    <p class="text-sm text-slate-500 mt-1">é›†å®¢ãƒ‡ãƒ¼ã‚¿ã«é–¢ã™ã‚‹è³ªå•ã‚„ã€æˆ¦ç•¥ã®å£æ‰“ã¡ç›¸æ‰‹ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <!-- AI Chat Interface -->
            <div class="card p-6 border-t-4 border-[#96c6c7] flex flex-col h-[600px]">
                <div id="chat-history" class="flex-grow overflow-y-auto custom-scrollbar p-4 bg-slate-50 rounded-lg mb-4 space-y-4">
                    <div class="flex items-start">
                        <div class="bg-cyan-50 text-cyan-900 p-3 rounded-lg rounded-tl-none text-sm max-w-[80%]">
                            ã“ã‚“ã«ã¡ã¯ï¼ã‚µãƒ­ãƒ³é›†å®¢ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿åˆ†æã‚„å¯¾ç­–ã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„ã€‚<br>ä¾‹ï¼šã€Œä¸€ç•ªåŠ¹ç‡ãŒè‰¯ã„åº—èˆ—ã¯ï¼Ÿã€ã€Œ1æœˆã®é›†å®¢çŠ¶æ³ã¯ï¼Ÿã€
                        </div>
                    </div>
                </div>
                <!-- Input Area -->
                <div class="flex gap-2">
                    <input type="text" id="chat-input" class="flex-grow border border-slate-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#96c6c7]" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">
                    <button onclick="sendChatMessage()" class="bg-theme bg-theme-hover text-white px-6 py-2 rounded-lg font-bold transition">é€ä¿¡</button>
                </div>
            </div>
        </section>

    </main>

    <!-- JavaScript Logic -->
    <script>
        const apiKey = ""; // Environment Variable

        // --- SALON BRAND CONTEXT (Extracted from URL) ---
        const BRAND_CONTEXT = `
        ã€ã‚µãƒ­ãƒ³åã€‘ç¾äººãƒã‚¹ãƒˆï¼ˆè¡¨å‚é“åº—ã‚’åŸºæº–ï¼‰
        ã€ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€‘åŒ»ç™‚ææºãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—å°‚é–€åº—ã€‚å®šé¡åˆ¶ï¼ˆã‚µãƒ–ã‚¹ã‚¯ï¼‰ã‚ã‚Šã€‚
        ã€ä¸»ãªå¼·ã¿ãƒ»USPã€‘
        1. å®Ÿç¸¾: ãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—æˆåŠŸç‡98%ã€2ã‚«ãƒƒãƒ—UPç¶šå‡ºã€æ–½è¡“å®Ÿç¸¾3ä¸‡äººè¶…ã€AAâ†’Fã‚«ãƒƒãƒ—äº‹ä¾‹ã‚ã‚Šã€‚
        2. æŠ€è¡“: ç‹¬è‡ªé–‹ç™ºãƒã‚·ãƒ¼ãƒ³ Ã— ç†Ÿç·´ãƒãƒ³ãƒ‰æŠ€è¡“ Ã— é«˜æ¿ƒåº¦è‚²ä¹³ç¾å®¹æ¶²å°å…¥ã€‚
        3. å·®åˆ¥åŒ–: ã€Œç—›ããªã„ã€ã€Œåˆ‡ã‚‰ãªã„ã€ã€Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã€ã€‚ä»–åº—ã§ãƒ€ãƒ¡ã ã£ãŸäººã€ç—©ã›å‹ã€ç”£å¾Œã‚‚OKã€‚
        4. ã‚µãƒãƒ¼ãƒˆ: å°‚é–€å®¶ç›£ä¿®ã®æ „é¤ŠæŒ‡å°ãƒ»é£Ÿäº‹æŒ‡å°ã‚ã‚Šï¼ˆå†…å´ã‹ã‚‰ã®ã‚±ã‚¢ï¼‰ã€‚
        5. ä¾¡æ ¼å¸¯: åˆå›ä½“é¨“ 7,700å††ã€œ9,900å††ï¼ˆé€šå¸¸2ä¸‡å††ç›¸å½“ï¼‰ã€‚
        ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€‘
        - ä»–ã®ã‚µãƒ­ãƒ³ã«é€šã£ãŸãŒåŠ¹æœãŒå‡ºãªã‹ã£ãŸäºº
        - è±Šèƒ¸æ‰‹è¡“ã¯æ€–ã„äºº
        - ç—©ã›å‹ã§ãƒã‚¹ãƒˆã«ãŠè‚‰ãŒã¤ã‹ãªã„äºº
        - ç”£å¾Œã®ä¸‹å‚ãƒ»å½¢å´©ã‚Œã«æ‚©ã‚€äºº
        - ãƒ–ãƒ©ã‚¤ãƒ€ãƒ«ã‚’æ§ãˆãŸèŠ±å«
        `;

        // --- GEMINI API UTILS ---
        async function callGeminiAPI(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "ã‚¨ãƒ©ãƒ¼ï¼šå›ç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚";
            }
        }

        // --- MARKETING AI LOGIC ---
        async function generateMarketingContent() {
            const type = document.getElementById('mkt-type').value;
            const target = document.getElementById('mkt-target').value;
            const trend = document.getElementById('mkt-trend').value;
            const resultArea = document.getElementById('mkt-result-area');

            // Set Loading State
            resultArea.innerHTML = '<div class="h-full flex flex-col justify-center items-center text-[#5f9ea0]"><div class="typing-indicator"><span></span><span></span><span></span></div><p class="mt-4 text-sm font-bold">AIãŒæœ€é©ãªã‚³ãƒ”ãƒ¼ã‚’è€ƒæ¡ˆä¸­...</p></div>';

            // Construct Prompt
            let instruction = `ã‚ãªãŸã¯Hot Pepper Beautyï¼ˆãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼ï¼‰ã®ç†Ÿç·´ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
            ä»¥ä¸‹ã®ã‚µãƒ­ãƒ³æƒ…å ±ï¼ˆBRAND_CONTEXTï¼‰ã‚’åŸºã«ã€æŒ‡å®šã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨å­£ç¯€æ„Ÿã«åˆã‚ã›ãŸé›†å®¢ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            Markdownå½¢å¼ã§å‡ºåŠ›ã—ã€é‡è¦ãªéƒ¨åˆ†ã¯å¤ªå­—ã«ã—ã¦ãã ã•ã„ã€‚
            çµµæ–‡å­—ã‚’é©åº¦ã«ä½¿ç”¨ã—ã€å¥³æ€§ãŒã‚¯ãƒªãƒƒã‚¯ã—ãŸããªã‚‹ã‚ˆã†ãªå…±æ„Ÿæ€§ã®é«˜ã„æ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚`;
            
            let userPrompt = `
            ã€ã‚µãƒ­ãƒ³æƒ…å ±ã€‘
            ${BRAND_CONTEXT}

            ã€ä½œæˆä¾é ¼å†…å®¹ã€‘
            ãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¨®é¡: ${getTypeLabel(type)}
            ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤: ${getTargetLabel(target)}
            ãƒ»å­£ç¯€/ãƒˆãƒ¬ãƒ³ãƒ‰è¦ç´ : ${trend || 'æŒ‡å®šãªã—ï¼ˆä»Šã®å­£ç¯€æ„Ÿã«åˆã‚ã›ã¦ï¼‰'}
            ãƒ»ç¾åœ¨ã®å¹´æœˆ: 2026å¹´1æœˆï¼ˆã¾ãŸã¯ç›´è¿‘ã®å­£ç¯€ï¼‰

            ã€å‡ºåŠ›è¦ä»¶ã€‘
            `;

            if (type === 'catch_copy') {
                userPrompt += `
                Hot Pepper Beautyã®æ¤œç´¢ä¸€è¦§ã‚„ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§ä½¿ãˆã‚‹ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã‚’10æ¡ˆä½œæˆã—ã¦ãã ã•ã„ã€‚
                - æ–‡å­—æ•°ã¯20æ–‡å­—ã€œ35æ–‡å­—ç¨‹åº¦
                - ã€Œé™å®šã€ã€Œä»Šã ã‘ã€ã€Œå®Ÿç¸¾ã€ãªã©ã®ãƒ•ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
                - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®æ‚©ã¿ã«åˆºã•ã‚‹è¨€è‘‰ã‚’é¸ã¶
                `;
            } else if (type === 'body_copy') {
                userPrompt += `
                ãƒ•ã‚©ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚„ãƒ–ãƒ­ã‚°ã§ä½¿ç”¨ã™ã‚‹é­…åŠ›çš„ãªç´¹ä»‹æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                - ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ30æ–‡å­—ä»¥å†…ï¼‰
                - æœ¬æ–‡ï¼ˆ400æ–‡å­—ç¨‹åº¦ï¼‰
                - æ§‹æˆ: å…±æ„Ÿï¼ˆæ‚©ã¿ï¼‰â†’ è§£æ±ºç­–ï¼ˆã‚µãƒ­ãƒ³ã®å¼·ã¿ãƒ»ãƒã‚·ãƒ³ãƒ»æ „é¤ŠæŒ‡å°ï¼‰â†’ æœªæ¥ï¼ˆãƒ™ãƒãƒ•ã‚£ãƒƒãƒˆï¼‰
                - æœ€å¾Œã«ã€Œã¾ãšã¯ä½“é¨“ã‚¯ãƒ¼ãƒãƒ³ã§ã€ã¨ã„ã†ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ã‚’å…¥ã‚Œã‚‹
                `;
            } else if (type === 'campaign') {
                userPrompt += `
                ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã«å‘ã‘ãŸæ–°ã—ã„ã‚¯ãƒ¼ãƒãƒ³ãƒ»ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¼ç”»ã‚’3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚
                å„æ¡ˆã«ã¤ã„ã¦ä»¥ä¸‹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ï¼š
                1. ã‚¯ãƒ¼ãƒãƒ³åï¼ˆHPBç”¨ã€çŸ­ãé­…åŠ›çš„ã«ï¼‰
                2. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ç‹™ã„
                3. ã‚ªãƒ•ã‚¡ãƒ¼å†…å®¹ï¼ˆæ–½è¡“å†…å®¹ã¨ä¾¡æ ¼ã®æ‰“ã¡å‡ºã—æ–¹ â€»ä¾¡æ ¼è‡ªä½“ã¯ä»®ã§OKï¼‰
                4. å‚™è€ƒï¼ˆã‚­ãƒ£ãƒƒãƒãƒ¼ãªè£œè¶³æ–‡ï¼‰
                `;
            } else if (type === 'line_message') {
                userPrompt += `
                LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§é…ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                - é–‹å°ç‡ã‚’ä¸Šã’ã‚‹ãŸã‚ã®1è¡Œç›®ã®å¹ãå‡ºã—ãƒ†ã‚­ã‚¹ãƒˆ
                - è¦ªã—ã¿ã‚„ã™ã„æœ¬æ–‡
                - ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„äºˆç´„ãƒªãƒ³ã‚¯ã¸ã®èª˜å°
                `;
            }

            // Call API
            const result = await callGeminiAPI(userPrompt, instruction);
            
            // Render Result
            resultArea.innerHTML = `<div id="mkt-result-content" class="prose max-w-none text-slate-700 text-sm">${marked.parse(result)}</div>`;
        }

        function getTypeLabel(val) {
            const map = { 'catch_copy': 'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼æ¡ˆ', 'body_copy': 'ãƒ–ãƒ­ã‚°/ç´¹ä»‹æ–‡', 'campaign': 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¼ç”»', 'line_message': 'LINEé…ä¿¡æ–‡' };
            return map[val] || val;
        }
        function getTargetLabel(val) {
            const map = { 'general': 'å…¨èˆ¬', 'skinny': 'ç—©ã›å‹', 'postpartum': 'ç”£å¾Œ', 'bridal': 'ãƒ–ãƒ©ã‚¤ãƒ€ãƒ«', 'failed': 'ä»–åº—çµŒé¨“è€…' };
            return map[val] || val;
        }
        function copyToClipboard(id) {
            const el = document.getElementById(id);
            if(!el) return;
            const text = el.innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }

        // --- CHAT LOGIC ---
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            const history = document.getElementById('chat-history');
            history.innerHTML += `<div class="flex justify-end"><div class="bg-slate-200 text-slate-800 p-3 rounded-lg rounded-tr-none text-sm max-w-[80%]">${text}</div></div>`;
            input.value = '';
            history.scrollTop = history.scrollHeight;

            const loadingId = 'loading-' + Date.now();
            history.innerHTML += `<div class="flex items-start" id="${loadingId}"><div class="bg-cyan-50 text-cyan-900 p-3 rounded-lg rounded-tl-none text-sm max-w-[80%]"><div class="typing-indicator"><span></span><span></span><span></span></div></div></div>`;
            history.scrollTop = history.scrollHeight;

            // Simplified Data Context for Chat
            const contextData = rawData.filter(d => d.category === state.currentCategory).map(d => `${d.date} ${d.name}: PV${d.pv}, æ–°è¦${d.new}`).join('\n');
            const prompt = `ãƒ¦ãƒ¼ã‚¶ãƒ¼è³ªå•: ${text}\n\né–¢é€£ãƒ‡ãƒ¼ã‚¿:\n${contextData.substring(0,5000)}`;
            const system = `ã‚ãªãŸã¯ç¾å®¹ã‚µãƒ­ãƒ³ã®ãƒ‡ãƒ¼ã‚¿åˆ†æã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚æä¾›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚`;

            const responseText = await callGeminiAPI(prompt, system);

            document.getElementById(loadingId).remove();
            history.innerHTML += `<div class="flex items-start"><div class="bg-cyan-50 text-cyan-900 p-3 rounded-lg rounded-tl-none text-sm max-w-[80%] prose">${marked.parse(responseText)}</div></div>`;
            history.scrollTop = history.scrollHeight;
        }


        // --- CORE APP LOGIC ---
        
        // FULL Raw Data (April 2025 to Jan 2026)
         const rawData = [
            // April
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1453, new: 6 },
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1294, new: 6 },
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1288, new: 10 },
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1099, new: 12 },
            { date: "2025/04", name: "ã‚·ãƒŸã‚¼ãƒ­ç¾äºº å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1316, new: 10 },
            { date: "2025/04", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2639, new: 37 },
            // May
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1643, new: 21 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1693, new: 15 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1586, new: 12 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1193, new: 12 },
            { date: "2025/05", name: "ã‚·ãƒŸã‚¼ãƒ­ç¾äºº å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1305, new: 10 },
            { date: "2025/05", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2809, new: 29 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1758, new: 7 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1069, new: 7 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2145, new: 11 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1205, new: 4 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2117, new: 12 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1140, new: 10 },
            // June
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1389, new: 5 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1461, new: 16 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1349, new: 11 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1157, new: 8 },
            { date: "2025/06", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 824, new: 4 },
            { date: "2025/06", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 584, new: 7 },
            { date: "2025/06", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2535, new: 27 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1413, new: 14 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 880, new: 8 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1837, new: 9 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 881, new: 3 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1765, new: 13 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 865, new: 10 },
            // July
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2149, new: 16 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1585, new: 15 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1590, new: 11 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1428, new: 17 },
            { date: "2025/07", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 852, new: 2 },
            { date: "2025/07", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 833, new: 7 },
            { date: "2025/07", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 3128, new: 26 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1788, new: 9 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 942, new: 6 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2504, new: 11 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 812, new: 11 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2311, new: 13 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1014, new: 3 },
            // August
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 607, new: 2 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1584, new: 17 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1706, new: 19 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1293, new: 8 },
            { date: "2025/08", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 607, new: 2 },
            { date: "2025/08", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 629, new: 5 },
            { date: "2025/08", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2078, new: 14 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1298, new: 10 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 775, new: 6 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2345, new: 11 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 618, new: 1 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2223, new: 12 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1050, new: 4 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1175, new: 6 },
            // September
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1615, new: 17 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1337, new: 15 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1404, new: 13 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1184, new: 11 },
            { date: "2025/09", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 602, new: 2 },
            { date: "2025/09", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 580, new: 6 },
            { date: "2025/09", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2145, new: 24 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1277, new: 6 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 692, new: 2 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2238, new: 10 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 704, new: 3 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1906, new: 11 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1001, new: 9 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1033, new: 6 },
            // October
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1513, new: 3 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1289, new: 17 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1477, new: 10 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1167, new: 12 },
            { date: "2025/10", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 887, new: 1 },
            { date: "2025/10", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 709, new: 2 },
            { date: "2025/10", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2330, new: 17 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1161, new: 6 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 894, new: 6 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2517, new: 11 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1012, new: 8 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1950, new: 11 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1008, new: 5 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1494, new: 6 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 903, new: 16 },
            // November
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1436, new: 10 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 948, new: 15 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1238, new: 11 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 860, new: 3 },
            { date: "2025/11", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 668, new: 2 },
            { date: "2025/11", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 629, new: 5 },
            { date: "2025/11", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1489, new: 8 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1044, new: 2 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 602, new: 6 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2079, new: 4 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1088, new: 5 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1534, new: 11 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 867, new: 9 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1482, new: 4 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 689, new: 2 },
            // December
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 703, new: 3 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 687, new: 7 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 817, new: 11 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 798, new: 1 },
            { date: "2025/12", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 445, new: 0 },
            { date: "2025/12", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 603, new: 4 },
            { date: "2025/12", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1125, new: 3 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 779, new: 2 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 482, new: 5 }, // Updated based on data
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1137, new: 9 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 974, new: 1 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1059, new: 9 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 621, new: 6 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 992, new: 9 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 509, new: 3 },
            { date: "2025/12", name: "ç¾äººï¼‹FCSS", type: "FC", plan: "SS", pv: 239, new: 3 },
            // January 2026
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1337, new: 5 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1442, new: 9 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1732, new: 17 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1546, new: 11 },
            { date: "2026/01", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 840, new: 0 },
            { date: "2026/01", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 979, new: 2 },
            { date: "2026/01", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1897, new: 32 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1404, new: 9 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 977, new: 2 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2299, new: 4 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1601, new: 12 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1918, new: 1 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1152, new: 7 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1763, new: 9 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1314, new: 15 },
            { date: "2026/01", name: "ç¾äººï¼‹FCSS", type: "FC", plan: "SS", pv: 422, new: 2 }
        ];

        // Populate category
        rawData.forEach(d => d.category = d.name.includes("ãƒã‚¤ãƒ«") ? 'nail' : 'bust');

        let state = { currentView: 'dashboard', currentCategory: 'bust', selectedSalon: null };
        const formatNumber = (num) => new Intl.NumberFormat('ja-JP').format(num);

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            document.getElementById('salon-selector').addEventListener('change', (e) => {
                state.selectedSalon = e.target.value;
                renderSalonDetail();
            });
            document.getElementById('chat-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendChatMessage(); });
        });

        function initApp() {
            const categoryData = rawData.filter(d => d.category === state.currentCategory);
            const salons = [...new Set(categoryData.map(d => d.name))];
            state.selectedSalon = salons[0] || 'ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“'; 
            updateCategoryUI();
            renderDashboard();
            populateSalonSelect();
            renderSalonDetail();
            switchView('dashboard');
        }

        function switchCategory(cat) {
            state.currentCategory = cat;
            const categoryData = rawData.filter(d => d.category === state.currentCategory);
            state.selectedSalon = categoryData[0]?.name || null;
            updateCategoryUI();
            renderDashboard();
            populateSalonSelect();
            renderSalonDetail();
        }

        function updateCategoryUI() {
            const btnBust = document.getElementById('cat-bust');
            const btnNail = document.getElementById('cat-nail');
            const btnBustM = document.getElementById('cat-bust-m');
            const btnNailM = document.getElementById('cat-nail-m');

            const activeClass = "px-4 py-1 text-sm rounded-md transition-all bg-white text-theme font-bold shadow-sm";
            const inactiveClass = "px-4 py-1 text-sm rounded-md transition-all text-slate-500 hover:text-slate-700 bg-transparent";
            const activeClassM = "px-4 py-1 text-xs rounded-md transition-all bg-white text-theme font-bold shadow-sm";
            const inactiveClassM = "px-4 py-1 text-xs rounded-md transition-all text-slate-500 hover:text-slate-700 bg-transparent";

            if (state.currentCategory === 'bust') {
                btnBust.className = activeClass;
                btnNail.className = inactiveClass;
                btnBustM.className = activeClassM;
                btnNailM.className = inactiveClassM;
                document.getElementById('current-cat-label').innerText = "ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢äº‹æ¥­";
            } else {
                btnBust.className = inactiveClass;
                btnNail.className = activeClass;
                btnBustM.className = inactiveClassM;
                btnNailM.className = activeClassM;
                document.getElementById('current-cat-label').innerText = "ãƒã‚¤ãƒ«äº‹æ¥­";
            }
        }

        function switchView(viewName) {
            ['dashboard', 'details', 'marketing', 'strategy'].forEach(v => {
                const section = document.getElementById(`view-${v}`);
                const btn = document.getElementById(`nav-${v}`);
                if (v === viewName) {
                    section.classList.remove('hidden');
                    btn.classList.add('active');
                } else {
                    section.classList.add('hidden');
                    btn.classList.remove('active');
                }
            });
            if(viewName === 'details') renderSalonDetail();
        }

        // --- DASHBOARD RENDER ---
        let trendChartInstance = null;
        function renderDashboard() {
            const filteredData = rawData.filter(d => d.category === state.currentCategory);
            // Sort months ensuring year crossing works (simple string sort works for 2025/04 -> 2026/01)
            const months = [...new Set(filteredData.map(d => d.date))].sort();
            
            let totalPV = 0, totalNew = 0;
            const monthlyPV = {}, monthlyNew = {};

            filteredData.forEach(d => {
                totalPV += d.pv;
                totalNew += d.new;
                if(!monthlyPV[d.date]) { monthlyPV[d.date] = 0; monthlyNew[d.date] = 0; }
                monthlyPV[d.date] += d.pv;
                monthlyNew[d.date] += d.new;
            });
            
            document.getElementById('kpi-total-pv').textContent = formatNumber(totalPV);
            document.getElementById('kpi-total-new').textContent = formatNumber(totalNew);
            document.getElementById('kpi-avg-cvr').textContent = totalPV > 0 ? ((totalNew/totalPV)*100).toFixed(2) + '%' : '0%';
            document.getElementById('kpi-active-salons').textContent = [...new Set(filteredData.map(d=>d.name))].length;

            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            if (trendChartInstance) trendChartInstance.destroy();
            trendChartInstance = new Chart(ctxTrend, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        { label: 'åˆè¨ˆPVæ•°', data: months.map(m=>monthlyPV[m]), borderColor: '#5f9ea0', backgroundColor: 'rgba(150, 198, 199, 0.2)', yAxisID: 'y', fill: true },
                        { label: 'æ–°è¦ç²å¾—æ•°', data: months.map(m=>monthlyNew[m]), borderColor: '#ff8c00', backgroundColor: 'transparent', yAxisID: 'y1', borderDash: [5,5] }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: {display:true, position:'left', title:{display:true, text:'PV'}}, y1: {display:true, position:'right', grid:{drawOnChartArea:false}, title:{display:true, text:'æ–°è¦'}} } }
            });

            // Table
            const tbody = document.getElementById('monthly-table-body');
            tbody.innerHTML = '';
            months.forEach(m => {
                const pv = monthlyPV[m], nw = monthlyNew[m];
                tbody.innerHTML += `<tr class="hover:bg-slate-50"><td class="px-3 py-2 font-medium">${m}</td><td class="px-3 py-2 text-right">${formatNumber(pv)}</td><td class="px-3 py-2 text-right font-bold">${formatNumber(nw)}</td><td class="px-3 py-2 text-right">${pv>0?((nw/pv)*100).toFixed(2):0}%</td></tr>`;
            });
        }

        // --- DETAIL RENDER ---
        function populateSalonSelect() {
            const select = document.getElementById('salon-selector');
            select.innerHTML = '';
            const categoryData = rawData.filter(d => d.category === state.currentCategory);
            [...new Set(categoryData.map(d => d.name))].forEach(s => {
                const opt = document.createElement('option');
                opt.value = s; opt.textContent = s;
                if(s === state.selectedSalon) opt.selected = true;
                select.appendChild(opt);
            });
        }
        
        let detailChartInstance = null;
        function renderSalonDetail() {
            if(!state.selectedSalon) return;
            const records = rawData.filter(d => d.name === state.selectedSalon);
            document.getElementById('detail-title').textContent = state.selectedSalon;
            document.getElementById('detail-type').textContent = records[0]?.type || '-';
            
            const totalPV = records.reduce((s,r)=>s+r.pv,0);
            document.getElementById('detail-avg-pv').textContent = formatNumber(Math.round(totalPV/records.length));

            const ctx = document.getElementById('detailChart').getContext('2d');
            if (detailChartInstance) detailChartInstance.destroy();
            detailChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: records.map(r=>r.date),
                    datasets: [
                        { label: 'æ–°è¦', data: records.map(r=>r.new), backgroundColor: '#fbbf24', yAxisID: 'y', order:2 },
                        { type: 'line', label: 'PV', data: records.map(r=>r.pv), borderColor: '#334155', yAxisID: 'y1', order:1 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: {display:true, position:'right', grid:{drawOnChartArea:false}}, y1: {display:true, position:'left'} } }
            });

            const tbody = document.getElementById('detail-table-body');
            tbody.innerHTML = '';
            let prevPV = 0;
            records.forEach((r,i) => {
                const diff = i===0 ? 0 : r.pv - prevPV;
                tbody.innerHTML += `<tr class="hover:bg-slate-50"><td class="py-3 px-4 font-medium">${r.date}</td><td class="py-3 px-4 text-xs text-slate-500">${r.plan}</td><td class="py-3 px-4 text-right">${formatNumber(r.pv)}</td><td class="py-3 px-4 text-right font-bold">${r.new}</td><td class="py-3 px-4 text-right text-xs ${diff>0?'text-green-600':'text-red-500'}">${diff>0?'+':''}${i===0?'-':diff}</td></tr>`;
                prevPV = r.pv;
            });
        }
    </script>
</body>
</html>
