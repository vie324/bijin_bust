<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.C consulting tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #96c6c7;
            --primary-dark: #5f9ea0;
            --primary-darker: #4a8385;
            --primary-light: #b8d8d9;
            --primary-lighter: #e0f2f2;
            --accent: #ff8c00;
            --accent-light: #ffb84d;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2f2 50%, #f0f9ff 100%);
            background-attachment: fixed;
            color: #1e293b;
            min-height: 100vh;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            height: 320px;
        }

        /* Enhanced Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 4px 20px -4px rgba(0, 0, 0, 0.08), 0 2px 8px -2px rgba(0, 0, 0, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(150, 198, 199, 0.2);
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px -8px rgba(0, 0, 0, 0.12), 0 4px 12px -4px rgba(0, 0, 0, 0.06);
        }

        /* KPI Card Styles */
        .kpi-card {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #ffffff 0%, #f8fffe 100%);
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 16px 0 0 16px;
        }
        .kpi-card.teal::before { background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%); }
        .kpi-card.emerald::before { background: linear-gradient(180deg, #34d399 0%, #10b981 100%); }
        .kpi-card.orange::before { background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 100%); }
        .kpi-card.purple::before { background: linear-gradient(180deg, #a78bfa 0%, #8b5cf6 100%); }

        .kpi-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .kpi-icon.teal { background: linear-gradient(135deg, var(--primary-lighter) 0%, var(--primary-light) 100%); }
        .kpi-icon.emerald { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
        .kpi-icon.orange { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .kpi-icon.purple { background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); }

        /* Trend Indicator */
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .trend-badge.up { background: #d1fae5; color: #059669; }
        .trend-badge.down { background: #fee2e2; color: #dc2626; }
        .trend-badge.neutral { background: #f1f5f9; color: #64748b; }

        /* Navigation Styles */
        .nav-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(150, 198, 199, 0.3);
        }

        .nav-btn {
            position: relative;
            padding: 0.6rem 1rem;
            border-radius: 10px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            color: #64748b;
        }
        .nav-btn:hover:not(.active) {
            background: var(--primary-lighter);
            color: var(--primary-dark);
        }
        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px -2px rgba(95, 158, 160, 0.4);
        }
        .nav-btn.special {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-darker) 100%);
            color: white;
            box-shadow: 0 4px 12px -2px rgba(95, 158, 160, 0.3);
        }
        .nav-btn.special:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        /* Category Switcher */
        .cat-switch {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 4px;
        }
        .cat-btn {
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            color: #64748b;
        }
        .cat-btn.active {
            background: white;
            color: var(--primary-dark);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        /* Section Header */
        .section-header {
            position: relative;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        .section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 2px;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            letter-spacing: -0.02em;
        }
        .section-subtitle {
            font-size: 0.875rem;
            color: #64748b;
            margin-top: 0.25rem;
        }

        /* Ranking Card */
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 0.875rem 1rem;
            border-radius: 12px;
            transition: all 0.2s ease;
            background: #fafafa;
            margin-bottom: 0.5rem;
        }
        .ranking-item:hover {
            background: var(--primary-lighter);
            transform: translateX(4px);
        }
        .ranking-badge {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            margin-right: 0.875rem;
        }
        .ranking-badge.gold { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; }
        .ranking-badge.silver { background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%); color: white; }
        .ranking-badge.bronze { background: linear-gradient(135deg, #fdba74 0%, #f97316 100%); color: white; }
        .ranking-badge.normal { background: #f1f5f9; color: #64748b; }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .data-table thead th {
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 0.875rem 1rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #475569;
            border-bottom: 2px solid #e2e8f0;
        }
        .data-table tbody tr {
            transition: all 0.2s ease;
        }
        .data-table tbody tr:hover {
            background: var(--primary-lighter);
        }
        .data-table tbody td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
        }

        /* Prose Styles for AI Content */
        .prose h3 {
            font-size: 1.1em;
            font-weight: 700;
            margin-top: 1.25em;
            margin-bottom: 0.5em;
            color: var(--primary-dark);
            border-bottom: 2px solid var(--primary-lighter);
            padding-bottom: 4px;
        }
        .prose strong {
            color: var(--primary-dark);
            font-weight: 600;
            background: linear-gradient(transparent 60%, var(--primary-lighter) 60%);
        }
        .prose blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1em;
            background-color: #f0f9f9;
            padding: 0.75em 1em;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #475569;
        }

        /* Loading Animation */
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            animation: typing 1s infinite;
            margin: 0 3px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-6px); opacity: 1; }
        }

        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--primary-light); border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        .animate-delay-1 { animation-delay: 0.1s; }
        .animate-delay-2 { animation-delay: 0.2s; }
        .animate-delay-3 { animation-delay: 0.3s; }
        .animate-delay-4 { animation-delay: 0.4s; }

        /* Pulse animation for live data */
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse-dot 2s infinite;
        }

        /* Mini chart sparkline area */
        .mini-chart {
            height: 40px;
            opacity: 0.8;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header & Navigation -->
    <nav class="nav-container sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-6">
                    <!-- Logo -->
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#96c6c7] to-[#5f9ea0] flex items-center justify-content-center shadow-lg">
                            <span class="text-white text-lg font-bold w-full text-center">BC</span>
                        </div>
                        <div>
                            <span class="text-lg font-bold text-slate-800 tracking-tight">B.C consulting</span>
                            <span class="text-lg font-bold text-[#5f9ea0]"> tools</span>
                        </div>
                    </div>
                    <!-- Category Switcher Desktop -->
                    <div class="hidden md:flex cat-switch">
                        <button onclick="switchCategory('bust')" id="cat-bust" class="cat-btn active">ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢</button>
                        <button onclick="switchCategory('nail')" id="cat-nail" class="cat-btn">ãƒã‚¤ãƒ«äº‹æ¥­</button>
                    </div>
                </div>
                <!-- Navigation Buttons -->
                <div class="flex items-center gap-2">
                    <button onclick="switchView('dashboard')" id="nav-dashboard" class="nav-btn active">
                        <span class="hidden sm:inline">å…¨ä½“åˆ†æ</span>
                        <span class="sm:hidden">åˆ†æ</span>
                    </button>
                    <button onclick="switchView('details')" id="nav-details" class="nav-btn">
                        <span class="hidden sm:inline">åº—èˆ—è©³ç´°</span>
                        <span class="sm:hidden">è©³ç´°</span>
                    </button>
                    <button onclick="switchView('marketing')" id="nav-marketing" class="nav-btn special">
                        <span class="mr-1">âœ¨</span>
                        <span class="hidden sm:inline">AIé›†å®¢ã‚³ãƒ”ãƒ¼</span>
                        <span class="sm:hidden">AI</span>
                    </button>
                    <button onclick="switchView('strategy')" id="nav-strategy" class="nav-btn">
                        <span class="hidden sm:inline">ã‚³ãƒ³ã‚µãƒ«AI</span>
                        <span class="sm:hidden">ç›¸è«‡</span>
                    </button>
                </div>
            </div>
            <!-- Mobile Category Switcher -->
            <div class="md:hidden pb-3 flex justify-center">
                <div class="cat-switch">
                    <button onclick="switchCategory('bust')" id="cat-bust-m" class="cat-btn active text-xs">ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢</button>
                    <button onclick="switchCategory('nail')" id="cat-nail-m" class="cat-btn text-xs">ãƒã‚¤ãƒ«</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-7xl">

        <!-- VIEW 1: DASHBOARD OVERVIEW -->
        <section id="view-dashboard" class="space-y-8">
            <!-- Section Header -->
            <div class="section-header">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div>
                        <h1 class="section-title">å…¨ä½“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¨ç§»</h1>
                        <p class="section-subtitle">
                            <span class="inline-flex items-center gap-2">
                                <span class="pulse-dot"></span>
                                é¸æŠä¸­: <span id="current-cat-label" class="font-semibold text-[#5f9ea0]">ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢</span>
                            </span>
                            <span class="text-slate-400 mx-2">|</span>
                            2025å¹´4æœˆã€œ2026å¹´1æœˆ
                        </p>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-slate-500">æœ€çµ‚æ›´æ–°</span>
                        <span class="text-xs font-semibold text-slate-700 bg-slate-100 px-2 py-1 rounded-md">2026/01</span>
                    </div>
                </div>
            </div>

            <!-- KPI Cards with Trends -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                <!-- Total PV -->
                <div class="card kpi-card teal p-5 animate-fade-in-up">
                    <div class="flex items-start justify-between">
                        <div class="kpi-icon teal">
                            <svg class="w-6 h-6 text-[#5f9ea0]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                        </div>
                        <span id="kpi-pv-trend" class="trend-badge neutral">-</span>
                    </div>
                    <div class="mt-4">
                        <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">æœŸé–“åˆè¨ˆ PVæ•°</p>
                        <p class="text-3xl font-bold text-slate-800 mt-1" id="kpi-total-pv">-</p>
                    </div>
                </div>

                <!-- Total New Customers -->
                <div class="card kpi-card emerald p-5 animate-fade-in-up animate-delay-1">
                    <div class="flex items-start justify-between">
                        <div class="kpi-icon emerald">
                            <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                            </svg>
                        </div>
                        <span id="kpi-new-trend" class="trend-badge neutral">-</span>
                    </div>
                    <div class="mt-4">
                        <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">æœŸé–“åˆè¨ˆ æ–°è¦æ•°</p>
                        <p class="text-3xl font-bold text-slate-800 mt-1" id="kpi-total-new">-</p>
                    </div>
                </div>

                <!-- Average CVR -->
                <div class="card kpi-card orange p-5 animate-fade-in-up animate-delay-2">
                    <div class="flex items-start justify-between">
                        <div class="kpi-icon orange">
                            <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                        <span id="kpi-cvr-trend" class="trend-badge neutral">-</span>
                    </div>
                    <div class="mt-4">
                        <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">å¹³å‡CVR</p>
                        <p class="text-3xl font-bold text-slate-800 mt-1" id="kpi-avg-cvr">-</p>
                    </div>
                </div>

                <!-- Active Salons -->
                <div class="card kpi-card purple p-5 animate-fade-in-up animate-delay-3">
                    <div class="flex items-start justify-between">
                        <div class="kpi-icon purple">
                            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                        <span class="text-xs text-slate-400">åº—èˆ—æ•°</span>
                    </div>
                    <div class="mt-4">
                        <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">åˆ†æå¯¾è±¡åº—èˆ—</p>
                        <p class="text-3xl font-bold text-slate-800 mt-1" id="kpi-active-salons">-</p>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                <!-- Main Trend Chart -->
                <div class="xl:col-span-2 card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-lg font-bold text-slate-800">æœˆåˆ¥æ¨ç§»</h2>
                            <p class="text-sm text-slate-500">PVæ•° vs æ–°è¦ç²å¾—æ•°</p>
                        </div>
                        <div class="flex items-center gap-4 text-xs">
                            <span class="flex items-center gap-1.5">
                                <span class="w-3 h-3 rounded-full bg-[#5f9ea0]"></span>
                                PVæ•°
                            </span>
                            <span class="flex items-center gap-1.5">
                                <span class="w-3 h-3 rounded-full bg-[#ff8c00]"></span>
                                æ–°è¦
                            </span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Store Ranking -->
                <div class="card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-lg font-bold text-slate-800">åº—èˆ—ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
                            <p class="text-sm text-slate-500">CVRåŠ¹ç‡ TOP5</p>
                        </div>
                        <select id="ranking-type" onchange="updateRanking()" class="text-xs border border-slate-200 rounded-lg px-3 py-1.5 focus:ring-2 focus:ring-[#96c6c7] focus:border-[#96c6c7]">
                            <option value="cvr">CVRåŠ¹ç‡</option>
                            <option value="pv">PVæ•°</option>
                            <option value="new">æ–°è¦æ•°</option>
                        </select>
                    </div>
                    <div id="ranking-list" class="space-y-1">
                        <!-- JS Populated -->
                    </div>
                </div>
            </div>

            <!-- Monthly Data Table & Quick Stats -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                <!-- Monthly Table -->
                <div class="xl:col-span-2 card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-bold text-slate-800">æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿è©³ç´°</h2>
                        <span class="text-xs text-slate-400">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å…¨æœŸé–“è¡¨ç¤º</span>
                    </div>
                    <div class="overflow-x-auto custom-scrollbar max-h-[320px]">
                        <table class="data-table">
                            <thead class="sticky top-0 z-10">
                                <tr>
                                    <th class="text-left rounded-tl-lg">å¹´æœˆ</th>
                                    <th class="text-right">åˆè¨ˆPV</th>
                                    <th class="text-right">åˆè¨ˆæ–°è¦</th>
                                    <th class="text-right">CVR</th>
                                    <th class="text-right rounded-tr-lg">å‰æœˆæ¯”PV</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-table-body">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Quick Stats Summary -->
                <div class="card p-6">
                    <h2 class="text-lg font-bold text-slate-800 mb-4">ã‚¯ã‚¤ãƒƒã‚¯ã‚µãƒãƒªãƒ¼</h2>
                    <div class="space-y-4">
                        <div class="p-4 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border border-emerald-100">
                            <p class="text-xs font-semibold text-emerald-600 uppercase mb-1">Best Month (PV)</p>
                            <p id="best-month-pv" class="text-lg font-bold text-slate-800">-</p>
                        </div>
                        <div class="p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-100">
                            <p class="text-xs font-semibold text-amber-600 uppercase mb-1">Best Month (æ–°è¦)</p>
                            <p id="best-month-new" class="text-lg font-bold text-slate-800">-</p>
                        </div>
                        <div class="p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-100">
                            <p class="text-xs font-semibold text-purple-600 uppercase mb-1">Best CVR Store</p>
                            <p id="best-cvr-store" class="text-lg font-bold text-slate-800 truncate">-</p>
                        </div>
                        <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 rounded-xl border border-slate-200">
                            <p class="text-xs font-semibold text-slate-600 uppercase mb-1">ç›´å–¶ vs FC</p>
                            <div class="flex items-center gap-2 mt-2">
                                <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden">
                                    <div id="direct-ratio-bar" class="h-full bg-gradient-to-r from-[#96c6c7] to-[#5f9ea0] rounded-full" style="width: 50%"></div>
                                </div>
                                <span id="direct-fc-ratio" class="text-sm font-semibold text-slate-700">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW 2: MARKETING AI -->
        <section id="view-marketing" class="space-y-6 hidden">
            <div class="section-header">
                <h1 class="section-title">HPBé›†å®¢ã‚³ãƒ”ãƒ¼è‡ªå‹•ç”Ÿæˆ</h1>
                <p class="section-subtitle">ã€Œç¾äººãƒã‚¹ãƒˆã€ç‹¬è‡ªã®å¼·ã¿ï¼ˆåŒ»ç™‚ææºã€98%æˆåŠŸå®Ÿç¸¾ï¼‰ã‚’å­¦ç¿’æ¸ˆã¿ã®AIãŒã€ãƒˆãƒ¬ãƒ³ãƒ‰ã«åˆã‚ã›ãŸæ–‡ç« ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Input Panel -->
                <div class="col-span-1 space-y-4">
                    <div class="card p-6">
                        <h2 class="font-bold text-slate-800 mb-5 flex items-center gap-2">
                            <span class="w-8 h-8 rounded-lg bg-gradient-to-br from-[#96c6c7] to-[#5f9ea0] flex items-center justify-center">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </span>
                            ç”Ÿæˆè¨­å®š
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">1. ä½œæˆã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</label>
                                <select id="mkt-type" class="w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] text-sm bg-white">
                                    <option value="catch_copy">ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼æ¡ˆ (ä¸€è¦§)</option>
                                    <option value="body_copy">ãƒ•ã‚©ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼/ãƒ–ãƒ­ã‚°æœ¬æ–‡</option>
                                    <option value="campaign">æ–°ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒ»ã‚¯ãƒ¼ãƒãƒ³ä¼ç”»</option>
                                    <option value="line_message">LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé…ä¿¡æ–‡</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">2. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤</label>
                                <select id="mkt-target" class="w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] text-sm bg-white">
                                    <option value="general">å…¨èˆ¬ (ãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ãŸã„æ–¹)</option>
                                    <option value="skinny">ç—©ã›å‹ã§å¤§ãããªã‚‰ãªã„æ–¹</option>
                                    <option value="postpartum">ç”£å¾Œã®ä¸‹å‚ãƒ»å½¢å´©ã‚Œã«æ‚©ã‚€æ–¹</option>
                                    <option value="bridal">çµå©šå¼ã‚’æ§ãˆãŸãƒ—ãƒ¬èŠ±å«</option>
                                    <option value="failed">ä»–åº—ã§åŠ¹æœãŒå‡ºãªã‹ã£ãŸæ–¹</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">3. å­£ç¯€ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰è¦ç´ </label>
                                <input type="text" id="mkt-trend" class="w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] text-sm" placeholder="ä¾‹: æ­£æœˆå¤ªã‚Šè§£æ¶ˆã€æ˜¥ã®å‡ºä¼šã„ã€è–„ç€ã®å­£ç¯€">
                            </div>

                            <button onclick="generateMarketingContent()" class="w-full bg-gradient-to-r from-[#96c6c7] to-[#5f9ea0] hover:from-[#7ab0b1] hover:to-[#4a8385] text-white py-3.5 rounded-xl font-bold shadow-lg transform transition-all active:scale-[0.98] flex justify-center items-center gap-2">
                                <span>âœ¨</span> AIã§ç”Ÿæˆã™ã‚‹
                            </button>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-cyan-50 to-teal-50 p-4 rounded-xl border border-cyan-100 text-sm text-cyan-800">
                        <div class="flex items-start gap-2">
                            <span class="text-lg">ğŸ’¡</span>
                            <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong> ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ”ãƒ¼ã¯Hot Pepper Beautyã®æ–‡å­—æ•°åˆ¶é™ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- Output Panel -->
                <div class="col-span-2">
                    <div id="mkt-output-card" class="card h-full min-h-[520px] flex flex-col">
                        <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-gradient-to-r from-slate-50 to-gray-50 rounded-t-2xl">
                            <h3 class="font-bold text-slate-700 flex items-center gap-2">
                                <svg class="w-5 h-5 text-[#5f9ea0]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                ç”Ÿæˆçµæœ
                            </h3>
                            <button onclick="copyToClipboard('mkt-result-content')" class="text-xs bg-white border border-slate-200 px-4 py-2 rounded-lg hover:bg-slate-50 text-slate-600 flex items-center gap-1.5 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                                ã‚³ãƒ”ãƒ¼
                            </button>
                        </div>
                        <div id="mkt-result-area" class="p-6 flex-grow overflow-y-auto custom-scrollbar">
                            <div class="h-full flex flex-col justify-center items-center text-slate-400">
                                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-[#e0f2f2] to-[#b8d8d9] flex items-center justify-center mb-4">
                                    <span class="text-4xl">ğŸª„</span>
                                </div>
                                <p class="text-center">å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¨­å®šã—ã¦<br>ã€Œç”Ÿæˆã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW 3: SALON DETAILS -->
        <section id="view-details" class="space-y-6 hidden">
            <div class="section-header">
                <h1 class="section-title">åº—èˆ—åˆ¥ è©³ç´°åˆ†æ</h1>
                <p class="section-subtitle">å€‹åˆ¥ã®åº—èˆ—ã®æœˆæ¬¡æ¨ç§»ã‚’ç¢ºèªã—ã€ç•°å¸¸å€¤ã®åŸå› ã‚’ç‰¹å®šã—ã¾ã™ã€‚</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Sidebar Selector -->
                <div class="col-span-1 card p-5">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-3">åº—èˆ—ã‚’é¸æŠ</label>
                    <select id="salon-selector" class="block w-full text-sm border-slate-200 focus:outline-none focus:ring-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] rounded-xl py-2.5 bg-white" size="12">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <!-- Detail Content -->
                <div class="col-span-3 space-y-6">
                    <div class="card p-6">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
                            <div>
                                <h2 id="detail-title" class="text-2xl font-bold text-slate-800">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                                <span id="detail-type" class="inline-block mt-2 px-3 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-[#e0f2f2] to-[#b8d8d9] text-[#5f9ea0]">-</span>
                            </div>
                            <div class="text-right bg-slate-50 rounded-xl p-4">
                                <div class="text-xs text-slate-500 uppercase font-semibold">å¹³å‡æœˆé–“PV</div>
                                <div id="detail-avg-pv" class="text-2xl font-bold text-slate-800 font-mono mt-1">-</div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="detailChart"></canvas>
                        </div>
                    </div>
                    <!-- Table -->
                    <div class="card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">æ¨ç§»ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h3>
                        <div class="overflow-x-auto custom-scrollbar">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th class="text-left rounded-tl-lg">å¹´æœˆ</th>
                                        <th class="text-left">ãƒ—ãƒ©ãƒ³</th>
                                        <th class="text-right">PVæ•°</th>
                                        <th class="text-right">æ–°è¦æ•°</th>
                                        <th class="text-right rounded-tr-lg">PVå‰æœˆæ¯”</th>
                                    </tr>
                                </thead>
                                <tbody id="detail-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW 4: STRATEGY & CHAT -->
        <section id="view-strategy" class="space-y-6 hidden">
            <div class="section-header">
                <h1 class="section-title">AIã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆãƒ»ãƒãƒ£ãƒƒãƒˆ</h1>
                <p class="section-subtitle">é›†å®¢ãƒ‡ãƒ¼ã‚¿ã«é–¢ã™ã‚‹è³ªå•ã‚„ã€æˆ¦ç•¥ã®å£æ‰“ã¡ç›¸æ‰‹ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
            </div>

            <!-- AI Chat Interface -->
            <div class="card p-6 flex flex-col h-[600px]" style="border-top: 4px solid #96c6c7;">
                <div id="chat-history" class="flex-grow overflow-y-auto custom-scrollbar p-4 bg-gradient-to-b from-slate-50 to-white rounded-xl mb-4 space-y-4">
                    <div class="flex items-start">
                        <div class="bg-gradient-to-r from-cyan-50 to-teal-50 text-slate-700 p-4 rounded-2xl rounded-tl-none text-sm max-w-[80%] border border-cyan-100">
                            <p class="font-semibold text-[#5f9ea0] mb-2">ğŸ¤– AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</p>
                            ã“ã‚“ã«ã¡ã¯ï¼ã‚µãƒ­ãƒ³é›†å®¢ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿åˆ†æã‚„å¯¾ç­–ã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„ã€‚<br><br>
                            <span class="text-slate-500">ä¾‹ï¼šã€Œä¸€ç•ªåŠ¹ç‡ãŒè‰¯ã„åº—èˆ—ã¯ï¼Ÿã€ã€Œ1æœˆã®é›†å®¢çŠ¶æ³ã¯ï¼Ÿã€</span>
                        </div>
                    </div>
                </div>
                <!-- Input Area -->
                <div class="flex gap-3">
                    <input type="text" id="chat-input" class="flex-grow border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#96c6c7] focus:border-[#96c6c7] text-sm" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">
                    <button onclick="sendChatMessage()" class="bg-gradient-to-r from-[#96c6c7] to-[#5f9ea0] hover:from-[#7ab0b1] hover:to-[#4a8385] text-white px-6 py-3 rounded-xl font-bold transition-all flex items-center gap-2">
                        <span>é€ä¿¡</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white/80 backdrop-blur border-t border-slate-200 mt-auto py-4">
        <div class="max-w-7xl mx-auto px-4 text-center text-xs text-slate-400">
            Â© 2026 B.C consulting tools - Powered by AI
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        const apiKey = ""; // Environment Variable

        // --- SALON BRAND CONTEXT ---
        const BRAND_CONTEXT = `
        ã€ã‚µãƒ­ãƒ³åã€‘ç¾äººãƒã‚¹ãƒˆï¼ˆè¡¨å‚é“åº—ã‚’åŸºæº–ï¼‰
        ã€ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€‘åŒ»ç™‚ææºãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—å°‚é–€åº—ã€‚å®šé¡åˆ¶ï¼ˆã‚µãƒ–ã‚¹ã‚¯ï¼‰ã‚ã‚Šã€‚
        ã€ä¸»ãªå¼·ã¿ãƒ»USPã€‘
        1. å®Ÿç¸¾: ãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—æˆåŠŸç‡98%ã€2ã‚«ãƒƒãƒ—UPç¶šå‡ºã€æ–½è¡“å®Ÿç¸¾3ä¸‡äººè¶…ã€AAâ†’Fã‚«ãƒƒãƒ—äº‹ä¾‹ã‚ã‚Šã€‚
        2. æŠ€è¡“: ç‹¬è‡ªé–‹ç™ºãƒã‚·ãƒ¼ãƒ³ Ã— ç†Ÿç·´ãƒãƒ³ãƒ‰æŠ€è¡“ Ã— é«˜æ¿ƒåº¦è‚²ä¹³ç¾å®¹æ¶²å°å…¥ã€‚
        3. å·®åˆ¥åŒ–: ã€Œç—›ããªã„ã€ã€Œåˆ‡ã‚‰ãªã„ã€ã€Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã€ã€‚ä»–åº—ã§ãƒ€ãƒ¡ã ã£ãŸäººã€ç—©ã›å‹ã€ç”£å¾Œã‚‚OKã€‚
        4. ã‚µãƒãƒ¼ãƒˆ: å°‚é–€å®¶ç›£ä¿®ã®æ „é¤ŠæŒ‡å°ãƒ»é£Ÿäº‹æŒ‡å°ã‚ã‚Šï¼ˆå†…å´ã‹ã‚‰ã®ã‚±ã‚¢ï¼‰ã€‚
        5. ä¾¡æ ¼å¸¯: åˆå›ä½“é¨“ 7,700å††ã€œ9,900å††ï¼ˆé€šå¸¸2ä¸‡å††ç›¸å½“ï¼‰ã€‚
        ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€‘
        - ä»–ã®ã‚µãƒ­ãƒ³ã«é€šã£ãŸãŒåŠ¹æœãŒå‡ºãªã‹ã£ãŸäºº
        - è±Šèƒ¸æ‰‹è¡“ã¯æ€–ã„äºº
        - ç—©ã›å‹ã§ãƒã‚¹ãƒˆã«ãŠè‚‰ãŒã¤ã‹ãªã„äºº
        - ç”£å¾Œã®ä¸‹å‚ãƒ»å½¢å´©ã‚Œã«æ‚©ã‚€äºº
        - ãƒ–ãƒ©ã‚¤ãƒ€ãƒ«ã‚’æ§ãˆãŸèŠ±å«
        `;

        // --- GEMINI API UTILS ---
        async function callGeminiAPI(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "ã‚¨ãƒ©ãƒ¼ï¼šå›ç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚";
            }
        }

        // --- MARKETING AI LOGIC ---
        async function generateMarketingContent() {
            const type = document.getElementById('mkt-type').value;
            const target = document.getElementById('mkt-target').value;
            const trend = document.getElementById('mkt-trend').value;
            const resultArea = document.getElementById('mkt-result-area');

            resultArea.innerHTML = '<div class="h-full flex flex-col justify-center items-center text-[#5f9ea0]"><div class="typing-indicator"><span></span><span></span><span></span></div><p class="mt-4 text-sm font-semibold">AIãŒæœ€é©ãªã‚³ãƒ”ãƒ¼ã‚’è€ƒæ¡ˆä¸­...</p></div>';

            let instruction = `ã‚ãªãŸã¯Hot Pepper Beautyï¼ˆãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼ï¼‰ã®ç†Ÿç·´ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
            ä»¥ä¸‹ã®ã‚µãƒ­ãƒ³æƒ…å ±ï¼ˆBRAND_CONTEXTï¼‰ã‚’åŸºã«ã€æŒ‡å®šã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨å­£ç¯€æ„Ÿã«åˆã‚ã›ãŸé›†å®¢ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            Markdownå½¢å¼ã§å‡ºåŠ›ã—ã€é‡è¦ãªéƒ¨åˆ†ã¯å¤ªå­—ã«ã—ã¦ãã ã•ã„ã€‚
            çµµæ–‡å­—ã‚’é©åº¦ã«ä½¿ç”¨ã—ã€å¥³æ€§ãŒã‚¯ãƒªãƒƒã‚¯ã—ãŸããªã‚‹ã‚ˆã†ãªå…±æ„Ÿæ€§ã®é«˜ã„æ–‡ç« ã«ã—ã¦ãã ã•ã„ã€‚`;

            let userPrompt = `
            ã€ã‚µãƒ­ãƒ³æƒ…å ±ã€‘
            ${BRAND_CONTEXT}

            ã€ä½œæˆä¾é ¼å†…å®¹ã€‘
            ãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¨®é¡: ${getTypeLabel(type)}
            ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤: ${getTargetLabel(target)}
            ãƒ»å­£ç¯€/ãƒˆãƒ¬ãƒ³ãƒ‰è¦ç´ : ${trend || 'æŒ‡å®šãªã—ï¼ˆä»Šã®å­£ç¯€æ„Ÿã«åˆã‚ã›ã¦ï¼‰'}
            ãƒ»ç¾åœ¨ã®å¹´æœˆ: 2026å¹´1æœˆ

            ã€å‡ºåŠ›è¦ä»¶ã€‘
            `;

            if (type === 'catch_copy') {
                userPrompt += `
                Hot Pepper Beautyã®æ¤œç´¢ä¸€è¦§ã‚„ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§ä½¿ãˆã‚‹ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã‚’10æ¡ˆä½œæˆã—ã¦ãã ã•ã„ã€‚
                - æ–‡å­—æ•°ã¯20æ–‡å­—ã€œ35æ–‡å­—ç¨‹åº¦
                - ã€Œé™å®šã€ã€Œä»Šã ã‘ã€ã€Œå®Ÿç¸¾ã€ãªã©ã®ãƒ•ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
                - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®æ‚©ã¿ã«åˆºã•ã‚‹è¨€è‘‰ã‚’é¸ã¶
                `;
            } else if (type === 'body_copy') {
                userPrompt += `
                ãƒ•ã‚©ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚„ãƒ–ãƒ­ã‚°ã§ä½¿ç”¨ã™ã‚‹é­…åŠ›çš„ãªç´¹ä»‹æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                - ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ30æ–‡å­—ä»¥å†…ï¼‰
                - æœ¬æ–‡ï¼ˆ400æ–‡å­—ç¨‹åº¦ï¼‰
                - æ§‹æˆ: å…±æ„Ÿï¼ˆæ‚©ã¿ï¼‰â†’ è§£æ±ºç­–ï¼ˆã‚µãƒ­ãƒ³ã®å¼·ã¿ãƒ»ãƒã‚·ãƒ³ãƒ»æ „é¤ŠæŒ‡å°ï¼‰â†’ æœªæ¥ï¼ˆãƒ™ãƒãƒ•ã‚£ãƒƒãƒˆï¼‰
                - æœ€å¾Œã«ã€Œã¾ãšã¯ä½“é¨“ã‚¯ãƒ¼ãƒãƒ³ã§ã€ã¨ã„ã†ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ã‚’å…¥ã‚Œã‚‹
                `;
            } else if (type === 'campaign') {
                userPrompt += `
                ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã«å‘ã‘ãŸæ–°ã—ã„ã‚¯ãƒ¼ãƒãƒ³ãƒ»ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¼ç”»ã‚’3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚
                å„æ¡ˆã«ã¤ã„ã¦ä»¥ä¸‹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ï¼š
                1. ã‚¯ãƒ¼ãƒãƒ³åï¼ˆHPBç”¨ã€çŸ­ãé­…åŠ›çš„ã«ï¼‰
                2. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ç‹™ã„
                3. ã‚ªãƒ•ã‚¡ãƒ¼å†…å®¹ï¼ˆæ–½è¡“å†…å®¹ã¨ä¾¡æ ¼ã®æ‰“ã¡å‡ºã—æ–¹ â€»ä¾¡æ ¼è‡ªä½“ã¯ä»®ã§OKï¼‰
                4. å‚™è€ƒï¼ˆã‚­ãƒ£ãƒƒãƒãƒ¼ãªè£œè¶³æ–‡ï¼‰
                `;
            } else if (type === 'line_message') {
                userPrompt += `
                LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§é…ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                - é–‹å°ç‡ã‚’ä¸Šã’ã‚‹ãŸã‚ã®1è¡Œç›®ã®å¹ãå‡ºã—ãƒ†ã‚­ã‚¹ãƒˆ
                - è¦ªã—ã¿ã‚„ã™ã„æœ¬æ–‡
                - ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„äºˆç´„ãƒªãƒ³ã‚¯ã¸ã®èª˜å°
                `;
            }

            const result = await callGeminiAPI(userPrompt, instruction);
            resultArea.innerHTML = `<div id="mkt-result-content" class="prose max-w-none text-slate-700 text-sm leading-relaxed">${marked.parse(result)}</div>`;
        }

        function getTypeLabel(val) {
            const map = { 'catch_copy': 'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼æ¡ˆ', 'body_copy': 'ãƒ–ãƒ­ã‚°/ç´¹ä»‹æ–‡', 'campaign': 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¼ç”»', 'line_message': 'LINEé…ä¿¡æ–‡' };
            return map[val] || val;
        }
        function getTargetLabel(val) {
            const map = { 'general': 'å…¨èˆ¬', 'skinny': 'ç—©ã›å‹', 'postpartum': 'ç”£å¾Œ', 'bridal': 'ãƒ–ãƒ©ã‚¤ãƒ€ãƒ«', 'failed': 'ä»–åº—çµŒé¨“è€…' };
            return map[val] || val;
        }
        function copyToClipboard(id) {
            const el = document.getElementById(id);
            if(!el) return;
            navigator.clipboard.writeText(el.innerText).then(() => alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼'));
        }

        // --- CHAT LOGIC ---
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            const history = document.getElementById('chat-history');
            history.innerHTML += `<div class="flex justify-end"><div class="bg-gradient-to-r from-slate-100 to-slate-200 text-slate-800 p-4 rounded-2xl rounded-tr-none text-sm max-w-[80%]">${text}</div></div>`;
            input.value = '';
            history.scrollTop = history.scrollHeight;

            const loadingId = 'loading-' + Date.now();
            history.innerHTML += `<div class="flex items-start" id="${loadingId}"><div class="bg-gradient-to-r from-cyan-50 to-teal-50 text-cyan-900 p-4 rounded-2xl rounded-tl-none text-sm max-w-[80%] border border-cyan-100"><div class="typing-indicator"><span></span><span></span><span></span></div></div></div>`;
            history.scrollTop = history.scrollHeight;

            const contextData = rawData.filter(d => d.category === state.currentCategory).map(d => `${d.date} ${d.name}: PV${d.pv}, æ–°è¦${d.new}`).join('\n');
            const prompt = `ãƒ¦ãƒ¼ã‚¶ãƒ¼è³ªå•: ${text}\n\né–¢é€£ãƒ‡ãƒ¼ã‚¿:\n${contextData.substring(0,5000)}`;
            const system = `ã‚ãªãŸã¯ç¾å®¹ã‚µãƒ­ãƒ³ã®ãƒ‡ãƒ¼ã‚¿åˆ†æã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚æä¾›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚`;

            const responseText = await callGeminiAPI(prompt, system);

            document.getElementById(loadingId).remove();
            history.innerHTML += `<div class="flex items-start"><div class="bg-gradient-to-r from-cyan-50 to-teal-50 text-slate-700 p-4 rounded-2xl rounded-tl-none text-sm max-w-[80%] prose border border-cyan-100">${marked.parse(responseText)}</div></div>`;
            history.scrollTop = history.scrollHeight;
        }


        // --- CORE APP LOGIC ---

        // Raw Data
        const rawData = [
            // April
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1453, new: 6 },
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1294, new: 6 },
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1288, new: 10 },
            { date: "2025/04", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1099, new: 12 },
            { date: "2025/04", name: "ã‚·ãƒŸã‚¼ãƒ­ç¾äºº å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1316, new: 10 },
            { date: "2025/04", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2639, new: 37 },
            // May
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1643, new: 21 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1693, new: 15 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1586, new: 12 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1193, new: 12 },
            { date: "2025/05", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1305, new: 10 },
            { date: "2025/05", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2809, new: 29 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1758, new: 7 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1069, new: 7 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2145, new: 11 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1205, new: 4 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2117, new: 12 },
            { date: "2025/05", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1140, new: 10 },
            // June
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1389, new: 5 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1461, new: 16 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1349, new: 11 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1157, new: 8 },
            { date: "2025/06", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 824, new: 4 },
            { date: "2025/06", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 584, new: 7 },
            { date: "2025/06", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2535, new: 27 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1413, new: 14 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 880, new: 8 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1837, new: 9 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 881, new: 3 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1765, new: 13 },
            { date: "2025/06", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 865, new: 10 },
            // July
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2149, new: 16 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1585, new: 15 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1590, new: 11 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1428, new: 17 },
            { date: "2025/07", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 852, new: 2 },
            { date: "2025/07", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 833, new: 7 },
            { date: "2025/07", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 3128, new: 26 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1788, new: 9 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 942, new: 6 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2504, new: 11 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 812, new: 11 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2311, new: 13 },
            { date: "2025/07", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1014, new: 3 },
            // August
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 607, new: 2 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1584, new: 17 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1706, new: 19 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1293, new: 8 },
            { date: "2025/08", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 607, new: 2 },
            { date: "2025/08", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 629, new: 5 },
            { date: "2025/08", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2078, new: 14 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1298, new: 10 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 775, new: 6 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2345, new: 11 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 618, new: 1 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2223, new: 12 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1050, new: 4 },
            { date: "2025/08", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1175, new: 6 },
            // September
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1615, new: 17 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1337, new: 15 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1404, new: 13 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1184, new: 11 },
            { date: "2025/09", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 602, new: 2 },
            { date: "2025/09", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 580, new: 6 },
            { date: "2025/09", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2145, new: 24 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1277, new: 6 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 692, new: 2 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2238, new: 10 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 704, new: 3 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1906, new: 11 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1001, new: 9 },
            { date: "2025/09", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1033, new: 6 },
            // October
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1513, new: 3 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1289, new: 17 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1477, new: 10 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1167, new: 12 },
            { date: "2025/10", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 887, new: 1 },
            { date: "2025/10", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 709, new: 2 },
            { date: "2025/10", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2330, new: 17 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1161, new: 6 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 894, new: 6 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2517, new: 11 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1012, new: 8 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1950, new: 11 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1008, new: 5 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1494, new: 6 },
            { date: "2025/10", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 903, new: 16 },
            // November
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1436, new: 10 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 948, new: 15 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1238, new: 11 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 860, new: 3 },
            { date: "2025/11", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 668, new: 2 },
            { date: "2025/11", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 629, new: 5 },
            { date: "2025/11", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1489, new: 8 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1044, new: 2 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 602, new: 6 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2079, new: 4 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1088, new: 5 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1534, new: 11 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 867, new: 9 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1482, new: 4 },
            { date: "2025/11", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 689, new: 2 },
            // December
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 703, new: 3 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 687, new: 7 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 817, new: 11 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 798, new: 1 },
            { date: "2025/12", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 445, new: 0 },
            { date: "2025/12", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 603, new: 4 },
            { date: "2025/12", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1125, new: 3 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 779, new: 2 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 482, new: 5 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1137, new: 9 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 974, new: 1 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1059, new: 9 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 621, new: 6 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 992, new: 9 },
            { date: "2025/12", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 509, new: 3 },
            { date: "2025/12", name: "ç¾äººï¼‹FCSS", type: "FC", plan: "SS", pv: 239, new: 3 },
            // January 2026
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1337, new: 5 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå¤§é˜ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1442, new: 9 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆé‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1732, new: 17 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå°å€‰", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1546, new: 11 },
            { date: "2026/01", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº è¡¨å‚é“", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 840, new: 0 },
            { date: "2026/01", name: "ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº é‚£è¦‡", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 979, new: 2 },
            { date: "2026/01", name: "ç¾äººãƒã‚¤ãƒ«ï¼‹å“å·é«˜è¼ª", type: "ç›´å–¶", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1897, new: 32 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå·å´", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1404, new: 9 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæ›å·åº—", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 977, new: 2 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæœ¬åšæœ¨", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 2299, new: 4 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæ—­å·", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1601, new: 12 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆç”ºç”°", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1918, new: 1 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆæµ„å¿ƒ", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1152, new: 7 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆåƒæ—©", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1763, new: 9 },
            { date: "2026/01", name: "ç¾äººãƒã‚¹ãƒˆå—æ£®ç”º", type: "FC", plan: "ãƒ©ã‚¤ãƒˆS", pv: 1314, new: 15 },
            { date: "2026/01", name: "ç¾äººï¼‹FCSS", type: "FC", plan: "SS", pv: 422, new: 2 }
        ];

        // Populate category
        rawData.forEach(d => d.category = d.name.includes("ãƒã‚¤ãƒ«") ? 'nail' : 'bust');

        let state = { currentView: 'dashboard', currentCategory: 'bust', selectedSalon: null };
        const formatNumber = (num) => new Intl.NumberFormat('ja-JP').format(num);

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            document.getElementById('salon-selector').addEventListener('change', (e) => {
                state.selectedSalon = e.target.value;
                renderSalonDetail();
            });
            document.getElementById('chat-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendChatMessage(); });
        });

        function initApp() {
            const categoryData = rawData.filter(d => d.category === state.currentCategory);
            const salons = [...new Set(categoryData.map(d => d.name))];
            state.selectedSalon = salons[0] || 'ç¾äººãƒã‚¹ãƒˆè¡¨å‚é“';
            updateCategoryUI();
            renderDashboard();
            populateSalonSelect();
            renderSalonDetail();
            switchView('dashboard');
        }

        function switchCategory(cat) {
            state.currentCategory = cat;
            const categoryData = rawData.filter(d => d.category === state.currentCategory);
            state.selectedSalon = categoryData[0]?.name || null;
            updateCategoryUI();
            renderDashboard();
            populateSalonSelect();
            renderSalonDetail();
        }

        function updateCategoryUI() {
            const btns = [
                { id: 'cat-bust', active: state.currentCategory === 'bust' },
                { id: 'cat-nail', active: state.currentCategory === 'nail' },
                { id: 'cat-bust-m', active: state.currentCategory === 'bust' },
                { id: 'cat-nail-m', active: state.currentCategory === 'nail' }
            ];
            btns.forEach(b => {
                const el = document.getElementById(b.id);
                if (b.active) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
            document.getElementById('current-cat-label').innerText = state.currentCategory === 'bust' ? "ãƒã‚¹ãƒˆãƒ»è‚Œã‚±ã‚¢" : "ãƒã‚¤ãƒ«äº‹æ¥­";
        }

        function switchView(viewName) {
            ['dashboard', 'details', 'marketing', 'strategy'].forEach(v => {
                const section = document.getElementById(`view-${v}`);
                const btn = document.getElementById(`nav-${v}`);
                if (v === viewName) {
                    section.classList.remove('hidden');
                    btn.classList.add('active');
                } else {
                    section.classList.add('hidden');
                    btn.classList.remove('active');
                }
            });
            if(viewName === 'details') renderSalonDetail();
        }

        // --- DASHBOARD RENDER ---
        let trendChartInstance = null;
        function renderDashboard() {
            const filteredData = rawData.filter(d => d.category === state.currentCategory);
            const months = [...new Set(filteredData.map(d => d.date))].sort();

            let totalPV = 0, totalNew = 0;
            const monthlyPV = {}, monthlyNew = {};

            filteredData.forEach(d => {
                totalPV += d.pv;
                totalNew += d.new;
                if(!monthlyPV[d.date]) { monthlyPV[d.date] = 0; monthlyNew[d.date] = 0; }
                monthlyPV[d.date] += d.pv;
                monthlyNew[d.date] += d.new;
            });

            // Calculate trends (comparing last month to previous)
            const lastMonth = months[months.length - 1];
            const prevMonth = months[months.length - 2];

            const pvChange = prevMonth ? ((monthlyPV[lastMonth] - monthlyPV[prevMonth]) / monthlyPV[prevMonth] * 100) : 0;
            const newChange = prevMonth ? ((monthlyNew[lastMonth] - monthlyNew[prevMonth]) / monthlyNew[prevMonth] * 100) : 0;

            const lastCVR = monthlyPV[lastMonth] > 0 ? (monthlyNew[lastMonth] / monthlyPV[lastMonth]) * 100 : 0;
            const prevCVR = prevMonth && monthlyPV[prevMonth] > 0 ? (monthlyNew[prevMonth] / monthlyPV[prevMonth]) * 100 : 0;
            const cvrChange = prevCVR > 0 ? lastCVR - prevCVR : 0;

            // Update KPIs
            document.getElementById('kpi-total-pv').textContent = formatNumber(totalPV);
            document.getElementById('kpi-total-new').textContent = formatNumber(totalNew);
            document.getElementById('kpi-avg-cvr').textContent = totalPV > 0 ? ((totalNew/totalPV)*100).toFixed(2) + '%' : '0%';
            document.getElementById('kpi-active-salons').textContent = [...new Set(filteredData.map(d=>d.name))].length;

            // Update trend badges
            updateTrendBadge('kpi-pv-trend', pvChange);
            updateTrendBadge('kpi-new-trend', newChange);
            updateTrendBadge('kpi-cvr-trend', cvrChange, true);

            // Render main chart
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            if (trendChartInstance) trendChartInstance.destroy();
            trendChartInstance = new Chart(ctxTrend, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'åˆè¨ˆPVæ•°',
                            data: months.map(m=>monthlyPV[m]),
                            borderColor: '#5f9ea0',
                            backgroundColor: 'rgba(150, 198, 199, 0.15)',
                            yAxisID: 'y',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#5f9ea0'
                        },
                        {
                            label: 'æ–°è¦ç²å¾—æ•°',
                            data: months.map(m=>monthlyNew[m]),
                            borderColor: '#ff8c00',
                            backgroundColor: 'transparent',
                            yAxisID: 'y1',
                            borderDash: [5,5],
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#ff8c00'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {display:true, position:'left', title:{display:true, text:'PV', font: {weight: 'bold'}}, grid: { color: 'rgba(0,0,0,0.05)' }},
                        y1: {display:true, position:'right', grid:{drawOnChartArea:false}, title:{display:true, text:'æ–°è¦', font: {weight: 'bold'}}}
                    }
                }
            });

            // Monthly Table
            const tbody = document.getElementById('monthly-table-body');
            tbody.innerHTML = '';
            let prevPVTotal = 0;
            months.forEach((m, idx) => {
                const pv = monthlyPV[m], nw = monthlyNew[m];
                const diff = idx === 0 ? 0 : pv - prevPVTotal;
                const diffClass = diff > 0 ? 'text-emerald-600' : diff < 0 ? 'text-red-500' : 'text-slate-400';
                const diffIcon = diff > 0 ? 'â†‘' : diff < 0 ? 'â†“' : '';
                tbody.innerHTML += `<tr><td class="font-semibold">${m}</td><td class="text-right font-mono">${formatNumber(pv)}</td><td class="text-right font-bold font-mono">${formatNumber(nw)}</td><td class="text-right font-mono">${pv>0?((nw/pv)*100).toFixed(2):0}%</td><td class="text-right font-mono ${diffClass}">${idx===0?'-':`${diffIcon} ${formatNumber(Math.abs(diff))}`}</td></tr>`;
                prevPVTotal = pv;
            });

            // Quick Summary
            let bestPVMonth = months[0], bestNewMonth = months[0];
            months.forEach(m => {
                if (monthlyPV[m] > monthlyPV[bestPVMonth]) bestPVMonth = m;
                if (monthlyNew[m] > monthlyNew[bestNewMonth]) bestNewMonth = m;
            });
            document.getElementById('best-month-pv').textContent = `${bestPVMonth} (${formatNumber(monthlyPV[bestPVMonth])} PV)`;
            document.getElementById('best-month-new').textContent = `${bestNewMonth} (${formatNumber(monthlyNew[bestNewMonth])}å)`;

            // Best CVR Store
            const storeStats = {};
            filteredData.forEach(d => {
                if (!storeStats[d.name]) storeStats[d.name] = { pv: 0, new: 0 };
                storeStats[d.name].pv += d.pv;
                storeStats[d.name].new += d.new;
            });
            let bestCVRStore = null, bestCVR = 0;
            Object.entries(storeStats).forEach(([name, stats]) => {
                const cvr = stats.pv > 0 ? stats.new / stats.pv : 0;
                if (cvr > bestCVR) { bestCVR = cvr; bestCVRStore = name; }
            });
            document.getElementById('best-cvr-store').textContent = bestCVRStore ? `${bestCVRStore.replace('ç¾äººãƒã‚¹ãƒˆ','').replace('ç¾äººãƒã‚¤ãƒ«ï¼‹','')} (${(bestCVR*100).toFixed(2)}%)` : '-';

            // Direct vs FC ratio
            let directPV = 0, fcPV = 0;
            filteredData.forEach(d => {
                if (d.type === 'ç›´å–¶') directPV += d.pv;
                else fcPV += d.pv;
            });
            const directRatio = (directPV + fcPV) > 0 ? (directPV / (directPV + fcPV)) * 100 : 50;
            document.getElementById('direct-ratio-bar').style.width = `${directRatio}%`;
            document.getElementById('direct-fc-ratio').textContent = `${Math.round(directRatio)}:${Math.round(100-directRatio)}`;

            // Render ranking
            updateRanking();
        }

        function updateTrendBadge(id, change, isAbsolute = false) {
            const el = document.getElementById(id);
            if (change > 0) {
                el.className = 'trend-badge up';
                el.innerHTML = `<span>â†‘</span> ${isAbsolute ? '+' + change.toFixed(2) + 'pt' : '+' + change.toFixed(1) + '%'}`;
            } else if (change < 0) {
                el.className = 'trend-badge down';
                el.innerHTML = `<span>â†“</span> ${isAbsolute ? change.toFixed(2) + 'pt' : change.toFixed(1) + '%'}`;
            } else {
                el.className = 'trend-badge neutral';
                el.innerHTML = '- å‰æœˆæ¯”';
            }
        }

        function updateRanking() {
            const type = document.getElementById('ranking-type').value;
            const filteredData = rawData.filter(d => d.category === state.currentCategory);

            const storeStats = {};
            filteredData.forEach(d => {
                if (!storeStats[d.name]) storeStats[d.name] = { pv: 0, new: 0 };
                storeStats[d.name].pv += d.pv;
                storeStats[d.name].new += d.new;
            });

            let rankings = Object.entries(storeStats).map(([name, stats]) => ({
                name,
                pv: stats.pv,
                new: stats.new,
                cvr: stats.pv > 0 ? (stats.new / stats.pv) * 100 : 0
            }));

            if (type === 'cvr') rankings.sort((a, b) => b.cvr - a.cvr);
            else if (type === 'pv') rankings.sort((a, b) => b.pv - a.pv);
            else rankings.sort((a, b) => b.new - a.new);

            const list = document.getElementById('ranking-list');
            list.innerHTML = '';
            rankings.slice(0, 5).forEach((r, i) => {
                const badgeClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : 'normal';
                const value = type === 'cvr' ? `${r.cvr.toFixed(2)}%` : type === 'pv' ? formatNumber(r.pv) : formatNumber(r.new);
                const shortName = r.name.replace('ç¾äººãƒã‚¹ãƒˆ', '').replace('ç¾äººãƒã‚¤ãƒ«ï¼‹', '').replace('ã‚·ãƒŸã‚±ã‚¢ZEROç¾äºº ', '').replace('ã‚·ãƒŸã‚¼ãƒ­ç¾äºº ', '');
                list.innerHTML += `
                    <div class="ranking-item">
                        <div class="ranking-badge ${badgeClass}">${i + 1}</div>
                        <div class="flex-grow">
                            <p class="font-semibold text-slate-800 text-sm truncate">${shortName || r.name}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-slate-800">${value}</p>
                        </div>
                    </div>
                `;
            });
        }

        // --- DETAIL RENDER ---
        function populateSalonSelect() {
            const select = document.getElementById('salon-selector');
            select.innerHTML = '';
            const categoryData = rawData.filter(d => d.category === state.currentCategory);
            [...new Set(categoryData.map(d => d.name))].forEach(s => {
                const opt = document.createElement('option');
                opt.value = s; opt.textContent = s;
                if(s === state.selectedSalon) opt.selected = true;
                select.appendChild(opt);
            });
        }

        let detailChartInstance = null;
        function renderSalonDetail() {
            if(!state.selectedSalon) return;
            const records = rawData.filter(d => d.name === state.selectedSalon);
            document.getElementById('detail-title').textContent = state.selectedSalon;
            document.getElementById('detail-type').textContent = records[0]?.type || '-';

            const totalPV = records.reduce((s,r)=>s+r.pv,0);
            document.getElementById('detail-avg-pv').textContent = formatNumber(Math.round(totalPV/records.length));

            const ctx = document.getElementById('detailChart').getContext('2d');
            if (detailChartInstance) detailChartInstance.destroy();
            detailChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: records.map(r=>r.date),
                    datasets: [
                        {
                            label: 'æ–°è¦',
                            data: records.map(r=>r.new),
                            backgroundColor: 'rgba(251, 191, 36, 0.8)',
                            borderColor: '#f59e0b',
                            borderWidth: 1,
                            borderRadius: 6,
                            yAxisID: 'y',
                            order:2
                        },
                        {
                            type: 'line',
                            label: 'PV',
                            data: records.map(r=>r.pv),
                            borderColor: '#334155',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#334155',
                            yAxisID: 'y1',
                            order:1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' }
                    },
                    scales: {
                        y: {display:true, position:'right', grid:{drawOnChartArea:false}, title:{display:true, text:'æ–°è¦'}},
                        y1: {display:true, position:'left', title:{display:true, text:'PV'}}
                    }
                }
            });

            const tbody = document.getElementById('detail-table-body');
            tbody.innerHTML = '';
            let prevPV = 0;
            records.forEach((r,i) => {
                const diff = i===0 ? 0 : r.pv - prevPV;
                const diffClass = diff > 0 ? 'text-emerald-600' : diff < 0 ? 'text-red-500' : 'text-slate-400';
                const diffIcon = diff > 0 ? 'â†‘' : diff < 0 ? 'â†“' : '';
                tbody.innerHTML += `<tr><td class="font-semibold">${r.date}</td><td class="text-xs text-slate-500">${r.plan}</td><td class="text-right font-mono">${formatNumber(r.pv)}</td><td class="text-right font-bold font-mono">${r.new}</td><td class="text-right font-mono ${diffClass}">${i===0?'-':`${diffIcon} ${formatNumber(Math.abs(diff))}`}</td></tr>`;
                prevPV = r.pv;
            });
        }
    </script>
</body>
</html>
